(self.webpackChunkmystical=self.webpackChunkmystical||[]).push([[580],{3580:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ViewMapModule:()=>G});var i=n(8583),a=n(4655),o=n(2680),r=n(7716),s=n(9699),l=n(1689),c=n(3679),d=n(8295),g=n(9983),p=n(1095);function u(e,t){if(1&e&&(r.TgZ(0,"div",13),r._UZ(1,"img",14),r.qZA()),2&e){const e=r.oxw();r.xp6(1),r.Q6J("src",e.imagePreview,r.LSH)}}function m(e,t){if(1&e&&(r.TgZ(0,"p",15),r._uU(1),r.qZA()),2&e){const e=r.oxw();r.xp6(1),r.Oqu(e.imageError)}}let h=(()=>{class e{constructor(e,t,n,i){this.dialogRef=e,this.data=t,this.toastr=n,this.viewController=i,this.selectedImage=null,this.imagePreview=null,this.imageError=null,this.getJson=(e,t,n)=>({label:e,latitude:t,longitude:n})}ngOnInit(){}onImageSelected(e){const t=e.target;if(t.files&&t.files.length>0){this.selectedImage=t.files[0];const e=2;if(this.selectedImage.size>1024*e*1024)return void(this.imageError=`Image is too large. Max allowed size is ${e} MB.`);const n=new FileReader;n.onload=()=>{this.imagePreview=n.result},n.readAsDataURL(this.selectedImage)}}onSave(){const e=this.toFormData(),t=this.getJson(this.data.label,this.data.latitude,this.data.longitude);e.append("payload",JSON.stringify(t)),this.viewController.postMarker(e).subscribe(e=>{this.toastr.success(e.message),this.dialogRef.close(Object.assign(Object.assign({},this.data),{image:this.selectedImage,imageBase64:this.imagePreview,id:e.response.id}))},e=>{console.log("error in onSave() -",e),this.toastr.error("Something went wrong")})}toFormData(){const e=new FormData;return this.selectedImage&&e.append("filePayload",this.selectedImage,this.selectedImage.name),e}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(o.so),r.Y36(o.WI),r.Y36(s._W),r.Y36(l.N))},e.\u0275cmp=r.Xpm({type:e,selectors:[["app-add-custom-marker-dialog"]],decls:25,vars:6,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["form","ngForm"],["appearance","fill",1,"full-width"],["matInput","","name","label","required","",3,"ngModel","ngModelChange"],["matInput","","name","latitude","type","number","required","",3,"ngModel","ngModelChange"],["matInput","","name","longitude","type","number","required","",3,"ngModel","ngModelChange"],["type","file","accept","image/*",3,"change"],["style","margin-top: 10px;",4,"ngIf"],["class","error",4,"ngIf"],["mat-dialog-actions","","align","end"],["mat-button","","mat-dialog-close",""],["mat-button","","color","primary",3,"disabled","click"],[2,"margin-top","10px"],["alt","Preview","width","100",3,"src"],[1,"error"]],template:function(e,t){if(1&e&&(r.TgZ(0,"h2",0),r._uU(1,"Add Marker"),r.qZA(),r.TgZ(2,"div",1),r.TgZ(3,"form",null,2),r.TgZ(5,"mat-form-field",3),r.TgZ(6,"mat-label"),r._uU(7,"Label"),r.qZA(),r.TgZ(8,"input",4),r.NdJ("ngModelChange",function(e){return t.data.label=e}),r.qZA(),r.qZA(),r.TgZ(9,"mat-form-field",3),r.TgZ(10,"mat-label"),r._uU(11,"Latitude"),r.qZA(),r.TgZ(12,"input",5),r.NdJ("ngModelChange",function(e){return t.data.latitude=e}),r.qZA(),r.qZA(),r.TgZ(13,"mat-form-field",3),r.TgZ(14,"mat-label"),r._uU(15,"Longitude"),r.qZA(),r.TgZ(16,"input",6),r.NdJ("ngModelChange",function(e){return t.data.longitude=e}),r.qZA(),r.qZA(),r.TgZ(17,"input",7),r.NdJ("change",function(e){return t.onImageSelected(e)}),r.qZA(),r.YNc(18,u,2,1,"div",8),r.YNc(19,m,2,1,"p",9),r.qZA(),r.qZA(),r.TgZ(20,"div",10),r.TgZ(21,"button",11),r._uU(22,"Cancel"),r.qZA(),r.TgZ(23,"button",12),r.NdJ("click",function(){return t.onSave()}),r._uU(24,"Save"),r.qZA(),r.qZA()),2&e){const e=r.MAs(4);r.xp6(8),r.Q6J("ngModel",t.data.label),r.xp6(4),r.Q6J("ngModel",t.data.latitude),r.xp6(4),r.Q6J("ngModel",t.data.longitude),r.xp6(2),r.Q6J("ngIf",t.imagePreview),r.xp6(1),r.Q6J("ngIf",t.imageError),r.xp6(4),r.Q6J("disabled",!e.valid)}},directives:[o.uh,o.xY,c._Y,c.JL,c.F,d.KE,d.hX,g.Nt,c.Fj,c.Q7,c.JJ,c.On,c.wV,i.O5,o.H8,p.lW,o.ZT],styles:[".full-width[_ngcontent-%COMP%]{width:100%;margin-bottom:10px}.error[_ngcontent-%COMP%]{color:red;font-weight:700}"]}),e})(),b=(()=>{class e{constructor(e,t,n,i){this.dialogRef=e,this.data=t,this.toastr=n,this.viewController=i}ngOnInit(){}onSave(){this.data.jsonObj.label=this.data.label,this.viewController.postDrawing(this.data.jsonObj).subscribe(e=>{this.toastr.success(e.message),this.dialogRef.close(Object.assign(Object.assign({},this.data),{id:e.response.id}))},e=>{console.log("error in onSave() -",e),this.toastr.error("Something went wrong")})}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(o.so),r.Y36(o.WI),r.Y36(s._W),r.Y36(l.N))},e.\u0275cmp=r.Xpm({type:e,selectors:[["app-add-label-dialog"]],decls:14,vars:2,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["form","ngForm"],["appearance","fill",1,"full-width"],["matInput","","name","label","required","",3,"ngModel","ngModelChange"],["mat-dialog-actions","","align","end"],["mat-button","","mat-dialog-close",""],["mat-button","","color","primary",3,"disabled","click"]],template:function(e,t){if(1&e&&(r.TgZ(0,"h2",0),r._uU(1,"Add Label"),r.qZA(),r.TgZ(2,"div",1),r.TgZ(3,"form",null,2),r.TgZ(5,"mat-form-field",3),r.TgZ(6,"mat-label"),r._uU(7,"Label"),r.qZA(),r.TgZ(8,"input",4),r.NdJ("ngModelChange",function(e){return t.data.label=e}),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.TgZ(9,"div",5),r.TgZ(10,"button",6),r._uU(11,"Cancel"),r.qZA(),r.TgZ(12,"button",7),r.NdJ("click",function(){return t.onSave()}),r._uU(13,"Save"),r.qZA(),r.qZA()),2&e){const e=r.MAs(4);r.xp6(8),r.Q6J("ngModel",t.data.label),r.xp6(4),r.Q6J("disabled",!e.valid)}},directives:[o.uh,o.xY,c._Y,c.JL,c.F,d.KE,d.hX,g.Nt,c.Fj,c.Q7,c.JJ,c.On,o.H8,p.lW,o.ZT],styles:[".full-width[_ngcontent-%COMP%]{width:100%;margin-bottom:10px}"]}),e})();var f=n(7960),w=n(5396);const M=["mapContainer"];function Z(e,t){1&e&&r.GkF(0)}function A(e,t){1&e&&r.GkF(0)}const k=function(e,t,n,i,a){return{label:e,latitude:t,longitude:n,id:i,view:a}};function T(e,t){if(1&e&&(r.ynx(0),r.YNc(1,A,1,0,"ng-container",22),r.BQk()),2&e){const e=r.oxw().$implicit,t=r.oxw(2),n=r.MAs(36);r.xp6(1),r.Q6J("ngTemplateOutlet",n)("ngTemplateOutletContext",r.qbA(2,k,e.label,e.latitude,e.longitude,e.id,t.selectedView))}}function x(e,t){if(1&e&&(r.ynx(0),r.YNc(1,T,2,8,"ng-container",24),r.BQk()),2&e){const e=t.$implicit,n=r.oxw(2);r.xp6(1),r.Q6J("ngIf",e.type!=n.TYPE_CAMERA)}}const v=function(e){return{label:"Detected Objects",count:e,message:"No object detected"}};function C(e,t){if(1&e&&(r.TgZ(0,"div",21),r.YNc(1,Z,1,0,"ng-container",22),r.YNc(2,x,2,1,"ng-container",23),r.qZA()),2&e){const e=r.oxw(),t=r.MAs(34);r.xp6(1),r.Q6J("ngTemplateOutlet",t)("ngTemplateOutletContext",r.VKq(3,v,e.detectedObjectCount)),r.xp6(1),r.Q6J("ngForOf",e.detectedObjectList)}}function O(e,t){1&e&&r.GkF(0)}function y(e,t){1&e&&r.GkF(0)}function q(e,t){if(1&e&&(r.ynx(0),r.YNc(1,y,1,0,"ng-container",22),r.BQk()),2&e){const e=t.$implicit,n=r.oxw(2),i=r.MAs(38);r.xp6(1),r.Q6J("ngTemplateOutlet",i)("ngTemplateOutletContext",r.qbA(2,k,e.label,e.latitude,e.longitude,e.id,n.selectedView))}}const _=function(e){return{label:"Marker List",count:e,message:" No Marker added"}};function P(e,t){if(1&e&&(r.TgZ(0,"div",21),r.YNc(1,O,1,0,"ng-container",22),r.YNc(2,q,2,8,"ng-container",23),r.qZA()),2&e){const e=r.oxw(),t=r.MAs(34);r.xp6(1),r.Q6J("ngTemplateOutlet",t)("ngTemplateOutletContext",r.VKq(3,_,e.customMarkerList.length)),r.xp6(1),r.Q6J("ngForOf",e.customMarkerList)}}function I(e,t){1&e&&r.GkF(0)}function J(e,t){1&e&&r.GkF(0)}const D=function(e,t,n,i){return{label:e,shapeName:t,id:n,latlng:i}};function N(e,t){if(1&e&&(r.ynx(0),r.YNc(1,J,1,0,"ng-container",22),r.BQk()),2&e){const e=t.$implicit;r.oxw(2);const n=r.MAs(40);r.xp6(1),r.Q6J("ngTemplateOutlet",n)("ngTemplateOutletContext",r.l5B(2,D,e.label,e.shapeName,e.id,e.latlng))}}const j=function(e){return{label:"Drawing List",count:e,message:" No Drawing added"}};function F(e,t){if(1&e&&(r.TgZ(0,"div",21),r.YNc(1,I,1,0,"ng-container",22),r.YNc(2,N,2,7,"ng-container",23),r.qZA()),2&e){const e=r.oxw(),t=r.MAs(34);r.xp6(1),r.Q6J("ngTemplateOutlet",t)("ngTemplateOutletContext",r.VKq(3,j,e.drawingList.length)),r.xp6(1),r.Q6J("ngForOf",e.drawingList)}}function U(e,t){if(1&e&&(r.TgZ(0,"div",30),r._uU(1),r.qZA()),2&e){const e=r.oxw().message;r.xp6(1),r.hij(" ",e," ")}}function Y(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div",25),r.TgZ(1,"div",26),r.TgZ(2,"h2",3),r._uU(3),r.qZA(),r.qZA(),r.TgZ(4,"div",27),r.TgZ(5,"img",28),r.NdJ("click",function(){return r.CHM(e),r.oxw().showView("")}),r.qZA(),r.qZA(),r.qZA(),r.YNc(6,U,2,1,"div",29)}if(2&e){const e=t.label,n=t.count;r.xp6(3),r.hij(" ",e,""),r.xp6(3),r.Q6J("ngIf",0==n)}}function E(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div",31),r.TgZ(1,"div",32),r._UZ(2,"img",33),r.qZA(),r.TgZ(3,"div",34),r._uU(4),r._UZ(5,"br"),r._uU(6),r.ALo(7,"number"),r.ALo(8,"number"),r.qZA(),r.TgZ(9,"div",35),r.TgZ(10,"mat-slide-toggle",36),r.NdJ("change",function(t){const n=r.CHM(e),i=n.label,a=n.id;return r.oxw().hideDetectedObjectFromMap(i,a,t)}),r.qZA(),r.qZA(),r.qZA()}if(2&e){const e=t.label,n=t.longitude,i=t.latitude;r.xp6(4),r.hij(" ",e," "),r.xp6(2),r.AsE(" ",r.xi3(7,3,i,"1.6-7")," , ",r.xi3(8,6,n,"1.6-7")," ")}}function S(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div",31),r.TgZ(1,"div",32),r._UZ(2,"img",37),r.qZA(),r.TgZ(3,"div",34),r._uU(4),r._UZ(5,"br"),r._uU(6),r.ALo(7,"number"),r.ALo(8,"number"),r.qZA(),r.TgZ(9,"div",35),r.TgZ(10,"mat-slide-toggle",36),r.NdJ("change",function(t){const n=r.CHM(e),i=n.label,a=n.id;return r.oxw().hideMarkerFromMap(i,a,t)}),r.qZA(),r.TgZ(11,"img",38),r.NdJ("click",function(){const t=r.CHM(e).id;return r.oxw().deleteCustomMarker(t)}),r.qZA(),r.qZA(),r.qZA()}if(2&e){const e=t.label,n=t.longitude,i=t.latitude;r.xp6(4),r.hij(" ",e," "),r.xp6(2),r.AsE(" ",r.xi3(7,3,i,"1.6-7")," , ",r.xi3(8,6,n,"1.6-7")," ")}}function B(e,t){if(1&e&&(r.TgZ(0,"span"),r._uU(1),r.ALo(2,"number"),r.ALo(3,"number"),r._UZ(4,"br"),r.qZA()),2&e){const e=t.$implicit;r.xp6(1),r.AsE(" ",r.xi3(2,2,e.lat,"1.6-7")," , ",r.xi3(3,5,e.lng,"1.6-7")," ")}}function Q(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div",39),r.TgZ(1,"div",40),r.TgZ(2,"span",41),r._uU(3),r._UZ(4,"br"),r.qZA(),r.YNc(5,B,5,8,"span",23),r.qZA(),r.TgZ(6,"div",32),r.TgZ(7,"span",42),r.NdJ("click",function(){const t=r.CHM(e).id;return r.oxw().deleteDrawing(t)}),r._UZ(8,"img",43),r.qZA(),r.qZA(),r.qZA()}if(2&e){const e=t.label,n=t.shapeName,i=t.latlng;r.xp6(3),r.AsE(" ",e," (",n," ) "),r.xp6(2),r.Q6J("ngForOf",i)}}const V=[{path:"",component:(()=>{class e{constructor(e,t,n,i){this.dialog=e,this.router=t,this.toastr=n,this.viewController=i,this.TYPE_CAMERA="camera",this.showLogs=!1,this.latitude=0,this.longitude=0,this.detectedObjectCount=0,this.selectedView="",this.detectedObjectList=[],this.customMarkerList=[],this.drawingList=[],this.detectedObjectMap=new Map,this.markerMap=new Map,this.imageMarkersMap=new Map,this.drawingMap=new Map}ngOnInit(){}ngAfterViewInit(){this.initMapLayer(),this.baseMaps={"Map View":this.mapLayer,"Satellite View":this.satelliteLayer},this.initMap(),this.addControlWithLayers(),this.initDrawControls(),this.dragAndDropCustomMarker(),this.getDetectedObjectList(),this.getCustomMarkerList(!0),this.getDrawingList(!0)}initMap(){this.map=L.map(this.mapContainer.nativeElement,{center:[27.188984,78.0257536],zoom:12,minZoom:8,maxZoom:19,zoomControl:!0,attributionControl:!0}),this.mapLayer.addTo(this.map)}initMapLayer(){this.mapLayer=L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,minZoom:8,attribution:"Map View"}),this.satelliteLayer=L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:19,minZoom:8,attribution:"Satellite View"})}addControlWithLayers(){L.control.layers(this.baseMaps).addTo(this.map),L.control.scale({imperial:!1,metric:!0}).addTo(this.map),this.map.on("mousemove",e=>{this.latitude=e.latlng.lat,this.longitude=e.latlng.lng})}getDetectedObjectList(){return this.viewController.getDetectedObjectList().subscribe({next:e=>{if(this.detectedObjectList=e,this.detectedObjectCount=this.detectedObjectList.filter(e=>e.type!=this.TYPE_CAMERA).length,this.map)this.addDetectedObjectMarkers(this.detectedObjectList),this.map.setView([this.detectedObjectList[0].latitude,this.detectedObjectList[0].longitude],10);else{const e=setInterval(()=>{this.map&&(this.addDetectedObjectMarkers(this.detectedObjectList),clearInterval(e))},100)}},error:e=>{console.error("Error in getDetectedObjectList:",e),this.toastr.error("Something went wrong")}}),this.detectedObjectList}addDetectedObjectMarkers(e){e.forEach(e=>{const t=this.getIconAndImageByType(e.type),n=L.icon({iconUrl:t,iconSize:[33,35],iconAnchor:[12,41]}),i=L.marker([e.latitude,e.longitude],{icon:n}).addTo(this.map);this.addTooltipToMarker(e.label,i),e.type!=this.TYPE_CAMERA&&this.showImageOnMarkerClick(i,e.imageType,e.imageBase64),this.detectedObjectMap.set(e.id,i)})}getIconAndImageByType(e){let t="";switch(e){case"person":t="assets/icons/person.png";break;case"vehicle":t="assets/icons/vehicle_car.png";break;case"animal":t="assets/icons/animal.png";break;case this.TYPE_CAMERA:t="assets/icons/camera.png";break;default:t="assets/icons/location.png"}return t}addTooltipToMarker(e,t){t.bindTooltip(`<b>${e}</b><br>`,{permanent:!1,direction:"top"})}showImageOnMarkerClick(e,t,n){e.on("click",()=>{if(this.imageMarkersMap.has(e))return;const i=e.getLatLng(),a=L.latLng(i.lat,i.lng-7e-4),o=L.divIcon({html:`<img src="data:${t};base64,${n}" style="width:600px; height:350px;" />`,iconSize:[300,100],iconAnchor:[0,0]}),r=L.marker(a,{icon:o,interactive:!0}).addTo(this.map);this.imageMarkersMap.set(e,r),r.on("click",()=>{this.map.removeLayer(r),this.imageMarkersMap.delete(e)})})}hideDetectedObjectFromMap(e,t,n){const i=this.detectedObjectMap.get(t);i&&(null!=n&&n.checked?(this.map.addLayer(i),this.addTooltipToMarker(e,i)):this.map.removeLayer(i))}showView(e){this.selectedView=e}onDragStart(e){var t;null===(t=e.dataTransfer)||void 0===t||t.setData("text/plain","button")}dragAndDropCustomMarker(){const e=this.map.getContainer();e.addEventListener("dragover",e=>{e.preventDefault()}),e.addEventListener("drop",t=>{t.preventDefault();const n=e.getBoundingClientRect(),i=this.map.containerPointToLatLng([t.clientX-n.left,t.clientY-n.top]);let a=i.lat,o=i.lng;const r=L.marker([a,o]).addTo(this.map);let s=`Dropped at:<br><b>Lat:</b> ${a.toFixed(5)}<br><b>Lng:</b> ${o.toFixed(5)}`;r.bindPopup(s).openPopup(),this.openAddCustomMarkerDialog(a,o,r)})}openAddCustomMarkerDialog(e,t,n){this.dialog.open(h,{width:"500px",data:{label:"",latitude:e,longitude:t}}).afterClosed().subscribe(e=>{e?(console.log("Dialog result:",e),this.addImageToCustomMarker(e,n),this.markerMap.set(e.id,n),this.getCustomMarkerList(!1)):this.map.removeLayer(n)})}addImageToCustomMarker(e,t){if(null!=e.image){let n=L.icon({iconUrl:e.imageBase64,iconSize:[23,25],iconAnchor:[12,41]});t.setIcon(n)}t.closePopup(),this.addTooltipToMarker(e.label,t)}getCustomMarkerList(e){return this.viewController.getMarkerList().toPromise().then(t=>{this.customMarkerList=t,e&&this.addCustomMarkersOnMap(this.customMarkerList)}),this.customMarkerList}addCustomMarkersOnMap(e){e.forEach(e=>{let t=L.marker();if(null!=e.image){const n=L.icon({iconUrl:`data:${e.imageType};base64,${e.image}`,iconSize:[33,35],iconAnchor:[12,41]});t=L.marker([e.latitude,e.longitude],{icon:n}).addTo(this.map)}else t=L.marker([e.latitude,e.longitude]).addTo(this.map);this.addTooltipToMarker(e.label,t),this.markerMap.set(e.id,t)})}deleteCustomMarker(e){this.viewController.deleteMarker(e).subscribe({next:t=>{this.toastr.success(t.message);const n=this.markerMap.get(e);n&&this.map.removeLayer(n),this.getCustomMarkerList(!1)},error:e=>{console.error("Error in deleteCustomMarker:",e),this.toastr.error("Something went wrong")}})}hideMarkerFromMap(e,t,n){const i=this.markerMap.get(t);i&&(null!=n&&n.checked?(this.map.addLayer(i),this.addTooltipToMarker(e,i)):this.map.removeLayer(i))}getDrawingList(e){return this.viewController.getDrawingList().toPromise().then(t=>{this.drawingList=t,e&&this.addDrawingOnMap(this.drawingList)}),this.drawingList}addDrawingOnMap(e){e.forEach(e=>{const t=e.shapeName;"POLYLINE"==t?this.drawPolyline(e):"CIRCLE"==t?this.drawCircle(e):this.drawPolygon(e)})}drawPolygon(e){const t=e.latlng.map(e=>[e.lat,e.lng]),n=L.polygon(t,{weight:3,fillOpacity:.4}).addTo(this.map);n.on("mousemove",t=>{n.bindPopup(`Label: ${e.label} <br> Area: ${e.area.toFixed(2)} km\xb2`).openPopup(t.latlng)}),this.drawingMap.set(e.id,n)}drawPolyline(e){const t=e.latlng.map(e=>[e.lat,e.lng]),n=L.featureGroup().addTo(this.map);L.polyline(t,{}).addTo(this.map).addTo(n),e.bearAndbackBearing.forEach((i,a)=>{const o=t[a],r=t[a+1];if(o&&r){const t=L.circleMarker([(o[0]+r[0])/2,(o[1]+r[1])/2],{radius:5,fillOpacity:0}).addTo(this.map).addTo(n);t.on("mousemove",n=>{t.bindPopup(`<b>${e.label}</b><br> Bearing: ${i.bearing}\xb0<br>Back: ${i.backBearing}\xb0`).openPopup(n.latlng)})}}),this.drawingMap.set(e.id,n)}drawCircle(e){const t=e.latlng[0],n=L.circle([t.lat,t.lng],{radius:e.radius,fillOpacity:.2}).addTo(this.map);n.on("mousemove",t=>{n.bindPopup(`Label: ${e.label} <br> Area: ${e.area.toFixed(2)} km\xb2`).openPopup(t.latlng)}),this.drawingMap.set(e.id,n)}deleteDrawing(e){this.viewController.deleteDrawing(e).subscribe({next:t=>{const n=this.drawingMap.get(e);this.map.removeLayer(n),this.getDrawingList(!1)},error:e=>{console.error("Error in deleteDrawing:",e),this.toastr.error("Something went wrong")}})}initDrawControls(){const e=new L.FeatureGroup;this.map.addLayer(e);const t=new L.Control.Draw({draw:{polygon:!0,polyline:!0,rectangle:!0,circle:!0,marker:!1,circlemarker:!1,path:!1},edit:{featureGroup:e}});this.map.addControl(t),this.map.on("draw:created",t=>{const n=t.layer;e.addLayer(n);let i={},a=[];const o=t.layerType;if(n instanceof L.Polygon){console.log("Polygon coordinates:",n.getLatLngs());const e=n.getLatLngs()[0],t=L.GeometryUtil.geodesicArea(e)/1e3,a=`Area covered: ${t.toFixed(2)} km\xb2`;if("rectangle"===o){const e=n.getBounds().getCenter();n.bindPopup(a),setTimeout(()=>{n.openPopup(e)},100)}else n.bindPopup(a).openPopup();i=this.createJsonForDrawings(o.toUpperCase(),"",e,t,null,null)}else if(n instanceof L.Polyline){const e=n.getLatLngs();console.log("Polyline coordinates:",e,e.length);let t=[];for(let i=0;i<e.length-1;i++){const o=this.calculateBearingAndBackBearing(e[i].lat,e[i].lng,e[i+1].lat,e[i+1].lng),r=(o+180)%360;t.push({bearing:o,backBearing:r});const s=e[i].lat,l=e[i].lng,c=`Bearing: ${o.toFixed(2)}\xb0<br>Backbearing: ${r.toFixed(2)}\xb0`;n.bindPopup(c).openPopup();const d=this.showPopup(s,l,c);a.push(d)}i=this.createJsonForDrawings(o.toUpperCase(),"",e,null,t,null)}else if(n instanceof L.Circle){const e=n._latlng;console.log("Circle coordinates:",n._latlng);const t=n.getRadius(),a=Math.PI*t*t/1e3,r=`Area covered: ${a.toFixed(2)} km\xb2`,s=n.getBounds().getCenter();n.bindPopup(r),setTimeout(()=>{n.openPopup(s)},100),i=this.createJsonForDrawings(o.toUpperCase(),"",[e],a,null,t)}else console.log("Unknown layer:",n);this.openAddlabelDialog(i,n,a)})}createJsonForDrawings(e,t,n,i,a,o){return{shapeName:e,label:t,latlng:n,area:i,bearAndbackBearing:a,radius:o}}openAddlabelDialog(e,t,n){this.dialog.open(b,{width:"500px",data:{label:"",jsonObj:e}}).afterClosed().subscribe(e=>{e?(console.log("Dialog result:",e),this.drawingMap.set(e.id,t),this.getDrawingList(!1)):(this.map.removeLayer(t),n.length&&(n.forEach(e=>this.map.removeLayer(e)),n=[]))})}showPopup(e,t,n){return console.log("showing popup"),L.popup().setLatLng([e,t]).setContent(n).addTo(this.map)}calculateBearingAndBackBearing(e,t,n,i){const a=e=>e*Math.PI/180,o=a(e),r=a(n),s=a(i-t),l=Math.sin(s)*Math.cos(r),c=Math.cos(o)*Math.sin(r)-Math.sin(o)*Math.cos(r)*Math.cos(s),d=(180*Math.atan2(l,c)/Math.PI+360)%360;return Number(d.toFixed(4))}ngOnDestroy(){this.map&&this.map.remove()}logoutFn(){localStorage.removeItem("signUpID"),localStorage.removeItem("user"),this.router.navigate(["/login"])}goBack(){this.router.navigate(["/camera"])}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(o.uw),r.Y36(a.F0),r.Y36(s._W),r.Y36(l.N))},e.\u0275cmp=r.Xpm({type:e,selectors:[["app-view-map"]],viewQuery:function(e,t){if(1&e&&r.Gf(M,5),2&e){let e;r.iGM(e=r.CRH())&&(t.mapContainer=e.first)}},decls:41,vars:12,consts:[[1,"header"],[1,"header-left"],["src","assets/icons/arrow_back.svg",1,"back",3,"click"],[1,"title"],[1,"header-right"],["draggable","true",1,"btn",3,"dragstart"],[1,"dropdown"],["type","button","data-bs-toggle","dropdown",1,"btn","btn-secondary","dropdown-toggle",2,"background-color","#008CBA"],[1,"dropdown-menu"],[1,"dropdown-item",3,"click"],[1,"mt-1"],[1,"row","full-height"],[3,"ngClass"],["id","map",1,"map-container"],["mapContainer",""],["class","col-2 float-end mt-2 scroll-panel",4,"ngIf"],[1,"coordinates"],["header",""],["detectedObjects",""],["showMarkerList",""],["showDrawingList",""],[1,"col-2","float-end","mt-2","scroll-panel"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"row"],[1,"col-sm-10"],[1,"col-sm-2"],["src","assets/icons/close.svg",2,"height","30px",3,"click"],["class","text-center",4,"ngIf"],[1,"text-center"],[1,"row","mt-2"],[1,"col-2"],["src","assets/icons/pin_drop.svg",1,"iconSize"],[1,"col-6"],[1,"col-4"],["checked","","color","primary",3,"change"],["src","assets/icons/marker-icon.png",1,"customMarkerIcon"],["src","assets/icons/delete.svg",1,"deleteIcon",3,"click"],[1,"row","mt-2","mb-3"],[1,"col-10"],[1,"fw-bold"],[3,"click"],["src","assets/icons/delete.svg",1,"deleteIcon","mb-2"]],template:function(e,t){1&e&&(r.TgZ(0,"div",0),r.TgZ(1,"div",1),r.TgZ(2,"img",2),r.NdJ("click",function(){return t.goBack()}),r.qZA(),r.TgZ(3,"p",3),r._uU(4,"VisionLOC - CCTV Object Detection Mapping Software"),r.qZA(),r.qZA(),r.TgZ(5,"div",4),r.TgZ(6,"button",5),r.NdJ("dragstart",function(e){return t.onDragStart(e)}),r._uU(7," Add Marker "),r.qZA(),r.TgZ(8,"div",6),r.TgZ(9,"button",7),r._uU(10," Show Actions "),r.qZA(),r.TgZ(11,"ul",8),r.TgZ(12,"li"),r.TgZ(13,"a",9),r.NdJ("click",function(){return t.showView("logs")}),r._uU(14,"Show Detections"),r.qZA(),r.qZA(),r.TgZ(15,"li"),r.TgZ(16,"a",9),r.NdJ("click",function(){return t.showView("markers")}),r._uU(17,"Show Markers"),r.qZA(),r.qZA(),r.TgZ(18,"li"),r.TgZ(19,"a",9),r.NdJ("click",function(){return t.showView("drawings")}),r._uU(20,"Show Drawings"),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r._UZ(21,"app-user-profile",10),r.qZA(),r.qZA(),r.TgZ(22,"div",11),r.TgZ(23,"div",12),r._UZ(24,"div",13,14),r.qZA(),r.YNc(26,C,3,5,"div",15),r.YNc(27,P,3,5,"div",15),r.YNc(28,F,3,5,"div",15),r.qZA(),r.TgZ(29,"div",16),r._uU(30),r.ALo(31,"number"),r.ALo(32,"number"),r.qZA(),r.YNc(33,Y,7,2,"ng-template",null,17,r.W1O),r.YNc(35,E,11,9,"ng-template",null,18,r.W1O),r.YNc(37,S,12,9,"ng-template",null,19,r.W1O),r.YNc(39,Q,9,3,"ng-template",null,20,r.W1O)),2&e&&(r.xp6(23),r.Q6J("ngClass",t.selectedView?"col-10":"col-12"),r.xp6(3),r.Q6J("ngIf","logs"==t.selectedView),r.xp6(1),r.Q6J("ngIf","markers"===t.selectedView),r.xp6(1),r.Q6J("ngIf","drawings"===t.selectedView),r.xp6(2),r.AsE(" ",r.xi3(31,6,t.latitude,"1.4-5"),", ",r.xi3(32,9,t.longitude,"1.4-5"),"\n"))},directives:[f.t,i.mk,i.O5,i.tP,i.sg,w.Rr],pipes:[i.JJ],styles:[".header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:10px 18px;border-bottom:1px solid #e0e0e0}.header-left[_ngcontent-%COMP%]{display:inline-flex;align-items:center}.header-left[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:18px;font-weight:700;margin-top:10px}.header-right[_ngcontent-%COMP%]{display:flex;grid-gap:12px;gap:12px}.header-right[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{background-color:#00966c;color:#fff;padding:10px 14px;border-radius:25px;font-weight:600;cursor:pointer;transition:background-color .2s}.header-right[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:hover{background-color:#007d5b}.map-container[_ngcontent-%COMP%]{height:750px}.iconSize[_ngcontent-%COMP%]{font-size:35px;margin-top:5px}.customMarkerIcon[_ngcontent-%COMP%]{width:20px;height:25px;margin-top:5px}.deleteIcon[_ngcontent-%COMP%]{font-size:35px;margin-left:10px;margin-bottom:7px}.coordinates[_ngcontent-%COMP%]{position:absolute;bottom:5px;padding:5px;font-size:18px;font-weight:700}.dropdown-menu[_ngcontent-%COMP%]   .dropdown-item[_ngcontent-%COMP%]:hover{background-color:#e6f0ff;color:#0056b3}.back[_ngcontent-%COMP%]{font-size:35px;margin-right:15px}.full-height[_ngcontent-%COMP%]{height:100vh;overflow:hidden;margin:0}.scroll-panel[_ngcontent-%COMP%]{height:100vh;overflow-y:auto;overflow-x:hidden;border-left:1px solid #ccc;padding:10px;background:#f9f9f9}"]}),e})()}];let $=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({imports:[[a.Bz.forChild(V)],a.Bz]}),e})();var z=n(674),R=n(3738),W=n(6314);let G=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({imports:[[i.ez,$,z.IJ,w.rP,c.u5,p.ot,o.Is,g.c,R.QW,W.Y]]}),e})()}}]);