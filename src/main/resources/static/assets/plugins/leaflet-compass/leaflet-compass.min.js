!function(t){if("function"==typeof define&&define.amd)define(["leaflet"],t);else if("undefined"!=typeof module)module.exports=t(require("leaflet"));else{if(void 0===window.L)throw"Leaflet must be loaded first";t(window.L)}}(function(t){return t.Control.Compass=t.Control.extend({includes:"1"==t.version[0]?t.Evented.prototype:t.Mixin.Events,options:{position:"topright",autoActive:!1,showDigit:!1,textErr:"",callErr:null,angleOffset:2},initialize:function(i){i&&i.style&&(i.style=t.Util.extend({},this.options.style,i.style)),t.Util.setOptions(this,i),this._errorFunc=this.options.callErr||this.showAlert,this._isActive=!1,this._currentAngle=null},onAdd:function(i){var e=this;this._map=i;var s=t.DomUtil.create("div","leaflet-compass");return this._button=t.DomUtil.create("span","compass-button",s),this._button.href="#",this._icon=t.DomUtil.create("div","compass-icon",this._button),this._digit=t.DomUtil.create("span","compass-digit",this._button),this._alert=t.DomUtil.create("div","compass-alert",s),this._alert.style.display="none",t.DomEvent.on(this._button,"click",t.DomEvent.stop,this).on(this._button,"click",this._switchCompass,this),t.DomEvent.on(window,"compassneedscalibration",function(t){e.showAlert("Your compass needs calibrating! Wave your device in a figure-eight motion")},this),this.options.autoActive&&this.activate(!0),s},onRemove:function(i){this.deactivate(),t.DomEvent.off(this._button,"click",t.DomEvent.stop,this).off(this._button,"click",this._switchCompass,this)},_switchCompass:function(){this._isActive?this.deactivate():this.activate()},_rotateHandler:function(t){var i;if(!this._isActive)return!1;t.webkitCompassHeading?(i=360-t.webkitCompassHeading,this._compassIphone=!0):t.alpha?(i=t.alpha-180,this._compassAndroid=!0):this._errorCompass({message:"Orientation angle not found"}),(i=Math.round(i))%this.options.angleOffset==0&&this.setAngle(i)},_errorCompass:function(t){this.deactivate(),this._errorFunc.call(this,this.options.textErr||t.message)},_rotateElement:function(t){var i=this._currentAngle;t.style.webkitTransform="rotate("+i+"deg)",t.style.MozTransform="rotate("+i+"deg)",t.style.transform="rotate("+i+"deg)"},setAngle:function(t){this.options.showDigit&&!isNaN(parseFloat(t))&&isFinite(t)&&(this._digit.innerHTML=-t+"\xb0"),this._currentAngle=t,this._rotateElement(this._icon),this.fire("compass:rotated",{angle:t})},getAngle:function(){return this._currentAngle},_activate:function(){this._isActive=!0,t.DomEvent.on(window,"deviceorientation",this._rotateHandler,this),t.DomUtil.addClass(this._button,"active")},activate:function(t){if("undefined"!=typeof DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission){var i=this;DeviceOrientationEvent.requestPermission().then(function(e){"granted"===e?i._activate():!0!==t&&alert("Cannot activate compass: permission "+e)},function(i){!0!==t&&alert("Error activating compass: "+i)})}else this._activate()},deactivate:function(){this.setAngle(0),this._isActive=!1,t.DomEvent.off(window,"deviceorientation",this._rotateHandler,this),t.DomUtil.removeClass(this._button,"active"),this.fire("compass:disabled")},showAlert:function(t){this._alert.style.display="block",this._alert.innerHTML=t;var i=this;clearTimeout(this.timerAlert),this.timerAlert=setTimeout(function(){i._alert.style.display="none"},5e3)}}),t.control.compass=function(i){return new t.Control.Compass(i)},t.Control.Compass});